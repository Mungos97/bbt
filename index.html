<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gewebe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        .low-stock {
            background-color: red;
            color: white;
        }
        input[type="number"] {
            width: 100px;
        }
    </style>
</head>
<body>

    <h1>BERBERTEC</h1>
    <table id="product-table">
        <thead>
            <tr>
                <th>Gewebe</th>
                <th>LÃ¤nge(m)</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <!-- Product rows JavaScript -->
        </tbody>
    </table>


    <script>
        const version = "1.2"; // promijenit broj ako dodam ili promijrnim mrezu
        let historyStack = []; 
    
        
        const updatedProductsInfo = [
        { name: "50/30/325", length:20, threshold: 10 }, 
        { name: "63/40/250 kal", length: 15, threshold: 10 }, 
        { name: "45/20/400 kal", length: 30, threshold: 10 }, 
        { name: "50/30/325 kal", length: 18, threshold: 5 },
        { name: "118/56/145 kal", length: 30, threshold: 10 }, 
        { name: "100/50/165", length: 30, threshold: 10 }, 
        { name: "40/28/370", length: 20, threshold: 5 },
        { name: "90/40/200", length: 30, threshold: 5 }, 
        { name: "40/25/400", length: 30, threshold: 10 },
        { name: "56/32/300", length: 30, threshold: 5 },
        { name: "45/20/400 kal", length: 30, threshold: 10 }, 
        { name: "140/65/120 kal", length: 30, threshold: 5 }, 
        { name: "63/40/250", length: 30, threshold: 10 }, 
        { name: "55/25/325 kal", length: 30, threshold: 10 },
        { name: "140/65/120", length: 30, threshold: 5 }, 
        ];
    
        function getProducts() {
            const storedVersion = localStorage.getItem('version');
            const storedProducts = localStorage.getItem('products');
    
            if (!storedProducts || storedVersion !== version) {
                let newProducts = [];
                if (storedProducts) {
                    const existingProducts = JSON.parse(storedProducts);
                    updatedProductsInfo.forEach((updatedProduct, index) => {
                        let existingProduct = existingProducts[index] || {};
                        newProducts.push({
                            name: updatedProduct.name,
                            length: existingProduct.length || updatedProduct.length || 0,
                            threshold: updatedProduct.threshold
                        });
                    });
                } else {
                    newProducts = updatedProductsInfo.map(product => ({
                        name: product.name,
                        length: 20, // Default length
                        threshold: product.threshold
                    }));
                }
                localStorage.setItem('products', JSON.stringify(newProducts));
                localStorage.setItem('version', version);
                return newProducts;
            }
    
            return JSON.parse(storedProducts);
        }
    
        let products = getProducts();
    
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }
    
        function updateTable() {
            const productTable = document.getElementById('product-table');
            productTable.innerHTML = ''; // Clear table
    
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                const isLowStock = product.length <= product.threshold;
    
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>
                        <input type="number" step="0.01" id="length-input-${index}" value="${product.length.toFixed(2)}" 
                            onchange="updateLength(${index}, this.value)" class="${isLowStock ? 'low-stock' : ''}">
                    </td>
                    <td>
                        <button onclick="subtractLength(${index})">Use 1.22m</button>
                    </td>
                `;
                productTable.appendChild(row);
            });
    
            
            const undoButton = document.getElementById('undo-button');
            undoButton.disabled = historyStack.length === 0; 
        }
    
        function storeHistory() {
            
            historyStack.push(JSON.stringify(products)); 
            console.log("History stack:", historyStack); 
            if (historyStack.length > 10) {
                historyStack.shift(); 
            }
    
            
            document.getElementById('undo-button').disabled = false;
        }
    
        function subtractLength(index) {
            storeHistory(); 
            if (products[index].length >= 1.22) {
                products[index].length -= 1.22;
            } else {
                products[index].length = 0; 
            }
            saveProducts(); 
            updateTable(); 
        }
    
        function updateLength(index, value) {
            const newLength = parseFloat(value);
            if (!isNaN(newLength) && newLength >= 0) { // Ensure valid number
                storeHistory(); // Save current state before change
                products[index].length = newLength;
                saveProducts(); // Save to localStorage after updating
            } else {
                alert("Please enter a valid non-negative number for the length.");
            }
            updateTable();
        }
    
        function undoLastAction() {
            if (historyStack.length > 0) {
                const lastState = historyStack.pop(); // Get last state
                console.log("Restoring to previous state:", lastState); // Debug: Log restored state
                products = JSON.parse(lastState); // Restore products
                saveProducts(); // Save restored state to localStorage
                updateTable(); // Re-render the table
    
                // Disable undo button if no more history
                document.getElementById('undo-button').disabled = historyStack.length === 0;
            }
        }
    
        window.onload = function () {
            updateTable(); // Initial rendering of table
        };
    </script>
    
    <!-- HTML -->
    <body>
        <table id="product-table"></table>
        <button id="undo-button" onclick="undoLastAction()" disabled>Undo</button> <!-- Undo button -->
    </body>
